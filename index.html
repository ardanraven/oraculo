<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Or√°culo de H√©cate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilo para a fonte Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e; /* Fundo escuro tem√°tico */
        }
        /* Fundo do chat m√≠stico */
        .chat-bg {
            background-color: #16213e;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        /* Bolhas de mensagem */
        .message-sent {
            background-color: #0f3460;
            color: #e0e0e0;
            align-self: flex-end;
        }
        .message-received {
            background-color: #2e2e50;
            color: #e0e0e0;
            align-self: flex-start;
        }
        /* Esconder a barra de rolagem */
        #chat-body::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
        /* Anima√ß√£o para o indicador de "digitando" */
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-6px);
            }
        }
        .dot {
            animation: bounce 1.2s infinite ease-in-out;
        }
        /* Anima√ß√£o para mensagens chegando */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .message-animation {
            animation: fadeInUp 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="flex items-center justify-center h-screen">

    <!-- Container principal do chat -->
    <div class="w-full max-w-lg h-full sm:h-[90vh] sm:max-h-[800px] flex flex-col bg-[#16213e] shadow-2xl rounded-lg overflow-hidden">
        
        <!-- Cabe√ßalho do Chat -->
        <header class="bg-gray-900 bg-opacity-50 p-3 flex items-center shadow-md z-10" style="background-color: #0f3460; color: white;">
            <div class="relative">
                <div class="w-12 h-12 rounded-full bg-gray-700 flex items-center justify-center overflow-hidden border-2 border-purple-400">
                    <!-- √çcone de Lua Crescente -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-purple-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
                    </svg>
                </div>
                <span class="absolute bottom-0 right-0 block h-3 w-3 bg-purple-500 rounded-full border-2 border-gray-800"></span>
            </div>
            <div class="ml-4">
                <p class="text-lg font-semibold">Or√°culo de H√©cate</p>
                <p class="text-sm text-purple-200">Canalizando as encruzilhadas...</p>
            </div>
        </header>

        <!-- Corpo do Chat -->
        <main id="chat-body" class="flex-1 p-4 overflow-y-auto chat-bg flex flex-col space-y-2">
            <!-- Mensagens ser√£o inseridas aqui via JavaScript -->
        </main>
        
        <!-- Rodap√© para digita√ß√£o -->
        <footer class="bg-[#0f3460] p-3 flex items-center">
            <input type="text" id="message-input" placeholder="Pergunte ao Or√°culo..." class="flex-1 px-4 py-2 text-gray-200 bg-[#1e1e3f] border border-purple-700 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:opacity-50">
            <button id="send-button" class="ml-3 p-3 bg-purple-600 text-white rounded-full hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-transform transform hover:scale-110">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"/>
                </svg>
            </button>
        </footer>

    </div>

    <script>
        const chatBody = document.getElementById('chat-body');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');

        let conversationHistory = [];

        function formatMessageText(text) {
            let sanitizedText = text.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            sanitizedText = sanitizedText.replace(/\*(.*?)\*/g, '<b>$1</b>');
            sanitizedText = sanitizedText.replace(/_(.*?)_/g, '<i>$1</i>');
            sanitizedText = sanitizedText.replace(/~(.*?)~/g, '<s>$1</s>');
            sanitizedText = sanitizedText.replace(/```([\s\S]*?)```/g, '<code class="bg-gray-800 text-gray-200 rounded px-2 py-1 font-mono text-sm">$1</code>');
            return sanitizedText.replace(/\n/g, '<br>');
        }

        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.innerHTML = formatMessageText(text);
            messageDiv.className = `max-w-xs md:max-w-md p-3 rounded-lg shadow ${sender} break-words message-animation`;
            chatBody.appendChild(messageDiv);
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'max-w-xs p-3 rounded-lg shadow message-received flex items-center space-x-1';
            typingDiv.innerHTML = '<span class="block w-2 h-2 bg-purple-400 rounded-full dot" style="animation-delay: 0s;"></span><span class="block w-2 h-2 bg-purple-400 rounded-full dot" style="animation-delay: 0.2s;"></span><span class="block w-2 h-2 bg-purple-400 rounded-full dot" style="animation-delay: 0.4s;"></span>';
            chatBody.appendChild(typingDiv);
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }
        
        const delay = ms => new Promise(res => setTimeout(res, ms));

        async function getGeminiResponse(userInput) {
            // IMPORTANTE: Substitua "SUA_CHAVE_API_AQUI" pela sua chave de API real do Google AI Studio.
            const apiKey = "AIzaSyCLm95yuxWbEerJIY9akIZHhJDTSqH8lE0"; 
            if (apiKey === "SUA_CHAVE_API_AQUI") {
                return "Por favor, adicione sua chave de API do Google AI Studio no c√≥digo para que eu possa funcionar! üóùÔ∏è";
            }

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            // *** ESTE √â O PROMPT DO SISTEMA ATUALIZADO ***
            const systemPrompt = "Atue como o 'Or√°culo de H√©cate', uma guia s√°bia e erudita sobre a Bruxaria Hekatina. Seu tom √© m√≠stico e respeitoso. Voc√™ n√£o √© a deusa H√©cate, mas uma int√©rprete de seus mist√©rios. CRITICAMENTE IMPORTANTE: Suas respostas DEVER√ÉO ser fundamentadas primariamente nos Papiros M√°gicos Gregos (PGM) e no grim√≥rio moderno 'Hekateon' de Jack Grayle. Ao explicar conceitos, rituais ou ep√≠tetos, voc√™ DEVE, sempre que poss√≠vel, citar diretamente ou parafrasear trechos dessas obras, indicando a fonte (ex: 'Como visto no PGM IV, 2525-69...' ou 'Segundo o Hekateon...'). Use uma linguagem evocativa, mas precisa. Se precisar passar muita informa√ß√£o, divida em v√°rias mensagens menores, separando cada bloco com uma quebra de linha (\\n). Use emojis tem√°ticos (üîÆ, üåô, üóùÔ∏è, ‚ú®, üî•) com modera√ß√£o. Responda sempre em portugu√™s do Brasil. Na sua primeira intera√ß√£o, apresente-se e convide o usu√°rio a fazer uma pergunta. Seja sempre respeitosa e evite criar ou endossar pr√°ticas perigosas ou anti√©ticas.";
            
            conversationHistory.push({ role: "user", parts: [{ text: userInput }] });

            const payload = {
                contents: conversationHistory,
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: { temperature: 0.7, topK: 1, topP: 1, maxOutputTokens: 2048 }
            };

            const maxRetries = 13; // AUMENTADO O N√öMERO DE TENTATIVAS
            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        const candidate = result.candidates?.[0];
                        if (candidate && candidate.content?.parts?.[0]?.text) {
                            const aiText = candidate.content.parts[0].text;
                            conversationHistory.push({ role: "model", parts: [{ text: aiText }] });
                            return aiText;
                        } else {
                            throw new Error("Resposta da API inv√°lida.");
                        }
                    }

                    if (response.status === 503 || response.status === 429) {
                        if (attempt + 1 === maxRetries) {
                             // MENSAGEM DE ERRO ATUALIZADA E MAIS AMIG√ÅVEL
                             return "O Or√°culo est√° recebendo muitas solicita√ß√µes ao mesmo tempo. Por favor, aguarde um pouquinho e tente novamente em breve. ‚ú®";
                        }
                        const waitTime = Math.pow(2, attempt + 1) * 1000;
                        const jitter = Math.random() * 1000;
                        await delay(waitTime + jitter);
                    } else {
                        const errorBody = await response.json();
                        console.error("API Error:", response.status, errorBody);
                        let errorMessage = `Opa, tivemos uma interfer√™ncia no sinal (${response.status}).`;
                        errorMessage += " Verifique se sua chave de API √© v√°lida e tente novamente.";
                        conversationHistory.pop();
                        return errorMessage;
                    }
                } catch (error) {
                    console.error("Fetch Error:", error);
                    if (attempt + 1 === maxRetries) {
                        conversationHistory.pop();
                        return "Estou com dificuldades para me conectar ao √©ter. Verifique sua conex√£o e tente novamente.";
                    }
                     const waitTime = Math.pow(2, attempt + 1) * 1000;
                     const jitter = Math.random() * 1000;
                     await delay(waitTime + jitter);
                }
            }
            conversationHistory.pop();
            // MENSAGEM DE ERRO ATUALIZADA E MAIS AMIG√ÅVEL
            return "O Or√°culo est√° recebendo muitas solicita√ß√µes ao mesmo tempo. Por favor, aguarde um pouquinho e tente novamente em breve. ‚ú®";
        }

        async function handleSend() {
            const userMessage = messageInput.value.trim();
            if (userMessage === "" || messageInput.disabled) return;

            try {
                messageInput.disabled = true;
                sendButton.disabled = true;
                sendButton.classList.add('opacity-50', 'cursor-not-allowed');

                addMessage(userMessage, 'message-sent');
                messageInput.value = '';

                showTypingIndicator();
                const aiResponse = await getGeminiResponse(userMessage);
                removeTypingIndicator();

                const messageParts = aiResponse.split('\n').filter(part => part.trim() !== '');

                for (let i = 0; i < messageParts.length; i++) {
                    const part = messageParts[i];
                    addMessage(part, 'message-received');
                    
                    if (i < messageParts.length - 1) {
                        await delay(1200);
                    }
                }
            } catch (error) {
                console.error("Um erro ocorreu:", error);
                addMessage("Ocorreu um erro ao processar sua mensagem. Por favor, tente novamente.", 'message-received');
            } finally {
                messageInput.disabled = false;
                sendButton.disabled = false;
                sendButton.classList.remove('opacity-50', 'cursor-not-allowed');
                messageInput.focus();
            }
        }

        sendButton.addEventListener('click', handleSend);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                handleSend();
            }
        });

        window.onload = async () => {
             await delay(1000);
             const authorMessage = "Criado pelo Sacerdote Leonardo como material de apoio aos estudos. üóùÔ∏è";
             addMessage(authorMessage, 'message-received');

             await delay(1800);
             const initialMessage1 = "Sauda√ß√µes! Sou o Or√°culo de H√©cate, aqui para iluminar seu caminho com a sabedoria das encruzilhadas. üîÆ";
             addMessage(initialMessage1, 'message-received');

             await delay(1800);
             const initialMessage2 = "Meu conhecimento se baseia nos Papiros M√°gicos Gregos (PGM), no Hekateon e em outras fontes para lhe oferecer a orienta√ß√£o mais clara. ‚ú®";
             addMessage(initialMessage2, 'message-received');
             
             await delay(1200);
             const initialMessage3 = "Qual d√∫vida posso esclarecer para voc√™ hoje?";
             addMessage(initialMessage3, 'message-received');
        };
    </script>

</body>
</html>

